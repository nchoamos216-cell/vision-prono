<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VISION PRONO - Pronostics quotidiens</title>

  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/6/6a/Soccer_ball.svg">

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>VISION PRONO</h1>
    <p>Pronostics gratuits ‚Ä¢ Mise √† jour quotidienne</p>
  </header>

  <main class="container">
    <div class="top-controls">
      <div id="date-jour" class="date-jour"></div>
      <button id="btn-refresh" class="btn">üîÑ Actualiser</button>
    </div>

    <section id="pronostics-jour" class="block">
      <h2>Pronostics du jour</h2>
      <div id="liste-jour"></div>
    </section>

    <section id="historique" class="block">
      <h2>Historique</h2>
      <div id="liste-historique"></div>
    </section>
  </main>

  <footer>
    <p>¬© <span id="annee"></span> - VISION PRONO | D√©velopp√© par AMOS N'CHO</p>
  </footer>

<script>
/*
  Format attendu (pronostics.json) :
  {
    "jours": [
      {
        "date": "13 novembre 2025",
        "matchs": [
          { "match": "France vs Ukraine", "pronostic": "Victoire...", "confiance": "‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ", "resultat": "gagn√©" }
        ]
      },
      ...
    ]
  }
*/

const ICONS = {
  gagne: '‚úÖ',   // on affiche emoji + classe couleur dans CSS
  perdu: '‚úñ',
  attente: 'üïí'
};

function statutToKey(s) {
  if (!s) return 'attente';
  const t = s.toLowerCase();
  if (t.includes('gagn')) return 'gagne';
  if (t.includes('perd')) return 'perdu';
  if (t.includes('attente') || t.includes('en attente') || t === 'pending') return 'attente';
  return 'attente';
}

function renderStars(conf) {
  if (!conf) return '<span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>'; // par d√©faut 5 √©toiles
  // si tu veux afficher exactement la valeur pass√©e, on l'affiche
  return `<span class="stars">${conf}</span>`;
}

function getIconHtml(resultat) {
  const key = statutToKey(resultat);
  const icon = ICONS[key === 'gagne' ? 'gagne' : key === 'perdu' ? 'perdu' : 'attente'];
  return `<span class="status status-${key}">${icon} ${key === 'gagne' ? 'Gagn√©' : key === 'perdu' ? 'Perdu' : 'En attente'}</span>`;
}

async function chargerPronostics() {
  try {
    // pour √©viter le cache
    const resp = await fetch('pronostics.json?_=' + new Date().getTime());
    if (!resp.ok) throw new Error('Impossible de charger pronostics.json');
    const data = await resp.json();
    if (!data.jours || !Array.isArray(data.jours)) {
      throw new Error('Format JSON invalide : "jours" manquant');
    }

    // on suppose que le dernier √©l√©ment est "aujourd'hui" (le plus r√©cent)
    const jours = data.jours;
    const dernier = jours[jours.length - 1];

    // afficher la date du jour en haut
    document.getElementById('date-jour').textContent = dernier ? `üóìÔ∏è ${dernier.date}` : '';

    // remplir la section "Pronostics du jour"
    const containerJour = document.getElementById('liste-jour');
    containerJour.innerHTML = '';
    if (!dernier || !Array.isArray(dernier.matchs) || dernier.matchs.length === 0) {
      containerJour.innerHTML = '<p>Aucun pronostic pour aujourd\'hui.</p>';
    } else {
      dernier.matchs.forEach(m => {
        const div = document.createElement('div');
        div.className = 'match-card';
        const iconHtml = getIconHtml(m.resultat);
        div.innerHTML = `
          <div class="match-left">
            <div class="match-title">${m.match}</div>
            <div class="match-prono"><strong>Pronostic :</strong> ${m.pronostic} ${renderStars(m.confiance)}</div>
          </div>
          <div class="match-right">
            <div class="match-result">${iconHtml}</div>
          </div>
        `;
        containerJour.appendChild(div);
      });
    }

    // remplir historique (tous les jours sauf le dernier), du plus r√©cent au plus ancien
    const histContainer = document.getElementById('liste-historique');
    histContainer.innerHTML = '';
    // on parcourt de l'avant-dernier jusqu'au premier pour afficher du plus r√©cent au plus ancien
    for (let i = jours.length - 2; i >= 0; i--) {
      const jour = jours[i];
      const jourBlock = document.createElement('div');
      jourBlock.className = 'jour-block';
      jourBlock.innerHTML = `<h3 class="jour-date">üóìÔ∏è ${jour.date}</h3>`;
      if (Array.isArray(jour.matchs)) {
        jour.matchs.forEach(m => {
          const mDiv = document.createElement('div');
          mDiv.className = 'match-card small';
          const iconHtml = getIconHtml(m.resultat);
          mDiv.innerHTML = `
            <div class="match-left">
              <div class="match-title">${m.match}</div>
              <div class="match-prono"><strong>Pronostic :</strong> ${m.pronostic} ${renderStars(m.confiance)}</div>
            </div>
            <div class="match-right">
              <div class="match-result">${iconHtml}</div>
            </div>
          `;
          jourBlock.appendChild(mDiv);
        });
      } else {
        jourBlock.innerHTML += '<p>Aucun match pour ce jour.</p>';
      }
      histContainer.appendChild(jourBlock);
    }

    // mettre ann√©e dans footer
    document.getElementById('annee').textContent = new Date().getFullYear();

  } catch (err) {
    document.getElementById('liste-jour').innerHTML = `<p style="color:crimson">Erreur : ${err.message}</p>`;
    console.error(err);
  }
}

document.getElementById('btn-refresh').addEventListener('click', () => {
  chargerPronostics();
});

window.addEventListener('load', chargerPronostics);
</script>
</body>
</html>
